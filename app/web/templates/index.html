<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Target Portfolio</title>

        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="static/css/styles.css" />
    </head>

    <body>
        <div class="container">
            <header class="app-header">
                <div class="brand">
                    <h1>Target Portfolio</h1>
                    <p class="lead">
                        Следи за целями портфеля, корректируй позиции и смотри
                        прогресс в реальном времени.
                    </p>
                </div>

                <div class="controls">
                    <button id="refresh-btn" class="btn ghost">Обновить</button>
                </div>
            </header>

            <main>
                <div class="top-row">
                    <div class="left-column">
                        <section class="card asset-add-card">
                            <div class="asset-search-body">
                                <div class="section-head">
                                    <div>
                                        <h3>Добавление актива</h3>
                                        <p class="hint">
                                            Найди акцию или облигацию и добавь в
                                            портфель
                                        </p>
                                    </div>
                                </div>

                                <div
                                    class="asset-search-type"
                                    role="tablist"
                                    aria-label="Тип актива"
                                >
                                    <button
                                        type="button"
                                        class="asset-type-btn active"
                                        data-type="share"
                                    >
                                        Акция
                                    </button>
                                    <button
                                        type="button"
                                        class="asset-type-btn"
                                        data-type="bond"
                                    >
                                        Облигация
                                    </button>
                                    <input
                                        type="hidden"
                                        id="asset-search-type"
                                        value="share"
                                    />
                                </div>

                                <div class="asset-search-input">
                                    <input
                                        id="asset-search-input"
                                        placeholder="SBER, AAPL, ОФЗ 26238…"
                                        autocomplete="off"
                                    />
                                </div>

                                <div
                                    id="asset-search-results"
                                    class="asset-search-results"
                                    aria-live="polite"
                                ></div>
                            </div>
                        </section>

                        <section class="card">
                            <div class="section-head">
                                <div>
                                    <h3>Портфель</h3>
                                    <p class="hint">
                                        Текущие позиции и целевые значения
                                    </p>
                                </div>

                                <div class="portfolio-meta">
                                    <span class="hint">Позиций:</span>
                                    <strong id="total-count">—</strong>
                                </div>
                            </div>

                            <div class="stats-grid">
                                <div class="stat">
                                    <h3>Общая стоимость</h3>
                                    <p id="total-value">— ₽</p>
                                </div>
                                <div class="stat">
                                    <h3>Достигнуто</h3>
                                    <p id="achieved-value">— %</p>
                                </div>
                                <div class="stat">
                                    <h3>Средняя цена</h3>
                                    <p id="average-price">— ₽</p>
                                </div>
                            </div>

                            <div class="table-wrap">
                                <table
                                    class="portfolio-table"
                                    aria-describedby="portfolio-desc"
                                >
                                    <colgroup>
                                        <col class="col-c-asset" />
                                        <col class="col-c-price" />
                                        <col class="col-c-current" />
                                        <col class="col-c-target" />
                                        <col class="col-c-value" />
                                        <col class="col-c-progress" />
                                    </colgroup>

                                    <thead>
                                        <tr>
                                            <th data-key="ticker">Актив</th>
                                            <th data-key="price">Цена</th>
                                            <th data-key="current_qty">
                                                Текущее
                                            </th>
                                            <th data-key="target_qty">Цель</th>
                                            <th data-key="value">Стоимость</th>
                                            <th>Прогресс</th>
                                        </tr>
                                    </thead>

                                    <tbody id="portfolio-body"></tbody>
                                </table>
                            </div>
                        </section>
                    </div>

                    <aside class="right-column">
                        <section class="card mini-card">
                            <div>
                                <strong>Структура портфеля</strong>
                                <div class="hint">Доли по стоимости</div>
                            </div>
                            <div class="pie-wrap">
                                <canvas
                                    id="pie-chart"
                                    width="240"
                                    height="240"
                                    aria-label="Структура портфеля"
                                ></canvas>
                                <div
                                    id="pie-legend"
                                    class="pie-legend"
                                    aria-hidden="false"
                                ></div>
                            </div>
                        </section>

                        <section class="card">
                            <h4 style="margin: 0 0 10px">Быстрые действия</h4>
                            <button id="bulk-export" class="btn ghost full">
                                Экспорт CSV
                            </button>
                        </section>
                    </aside>
                </div>
            </main>
        </div>

        <div id="modal-root" class="modal-overlay" aria-hidden="true">
            <div
                class="modal"
                role="dialog"
                aria-modal="true"
                aria-labelledby="modal-title"
            >
                <h3 id="modal-title">Изменить актив</h3>

                <div class="field">
                    <label>Тикер</label>
                    <input id="edit-ticker" disabled />
                </div>
                <div class="field">
                    <label>Тип</label>
                    <select id="edit-type">
                        <option value="share">Акция</option>
                        <option value="bond">Облигация</option>
                    </select>
                </div>
                <div class="field">
                    <label>Текущее количество</label>
                    <input id="edit-current" type="number" min="0" />
                </div>
                <div class="field">
                    <label>Цель</label>
                    <input id="edit-target" type="number" min="0" />
                </div>

                <div class="modal-actions">
                    <button id="save-edit" class="btn">Сохранить</button>
                    <button id="delete-edit" class="btn ghost">Удалить</button>
                    <button id="close-edit" class="btn ghost">Отмена</button>
                </div>
            </div>
        </div>

        <div id="add-root" class="modal-overlay" aria-hidden="true">
            <div
                class="modal"
                role="dialog"
                aria-modal="true"
                aria-labelledby="add-title"
            >
                <h3 id="add-title">Добавить актив</h3>

                <div class="field">
                    <label>Тикер</label>
                    <input id="add-ticker" placeholder="SBER" />
                </div>

                <div class="field">
                    <label>Тип</label>
                    <div id="add-type-switch" class="asset-search-type">
                        <button
                            type="button"
                            class="asset-type-btn active"
                            data-type="share"
                        >
                            Акция
                        </button>
                        <button
                            type="button"
                            class="asset-type-btn"
                            data-type="bond"
                        >
                            Облигация
                        </button>
                    </div>
                    <input type="hidden" id="add-type" value="share" />
                </div>

                <div class="field">
                    <label>Текущее количество</label>
                    <input id="add-current" type="number" min="0" />
                </div>

                <div class="field">
                    <label>Цель</label>
                    <input id="add-target" type="number" min="0" />
                </div>

                <div class="modal-actions">
                    <button id="submit-add" class="btn secondary">
                        Добавить
                    </button>
                    <button id="close-add" class="btn ghost">Отмена</button>
                </div>
            </div>
        </div>

        <div id="toast" class="toast" role="status" aria-live="polite"></div>

        <template id="row-template">
            <tr>
                <td class="col-asset">
                    <strong class="row-ticker">TICK</strong>
                    <span class="asset-type hint">Тип</span>
                </td>
                <td class="col-num">0 ₽</td>
                <td class="col-num">0</td>
                <td class="col-num">0</td>
                <td class="col-num strong">0 ₽</td>
                <td class="col-progress">
                    <div
                        class="progress"
                        role="progressbar"
                        aria-valuemin="0"
                        aria-valuemax="100"
                        aria-valuenow="0"
                    >
                        <div class="bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-percent">0%</div>
                </td>
            </tr>
        </template>

        <script src="static/js/pie-chart.js"></script>
        <script src="static/js/scripts.js"></script>
    </body>
</html>
